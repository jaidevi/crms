
-- ... (existing schema) ...


-- 13. Audit Logs Table
-- Tracks all changes made to key tables for history and restore functionality.
CREATE TABLE IF NOT EXISTS audit_logs (
    id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
    table_name TEXT NOT NULL,
    record_id TEXT NOT NULL,
    action TEXT NOT NULL, -- 'CREATE', 'UPDATE', 'DELETE'
    old_data JSONB, -- Snapshot before change
    new_data JSONB, -- Snapshot after change
    changed_by TEXT DEFAULT 'Admin', -- Placeholder for user system
    timestamp TIMESTAMPTZ DEFAULT NOW()
);

ALTER TABLE audit_logs ENABLE ROW LEVEL SECURITY;
CREATE POLICY "Audit logs are viewable by everyone." ON audit_logs FOR SELECT USING (true);
CREATE POLICY "Users can insert audit logs." ON audit_logs FOR INSERT WITH CHECK (true);
