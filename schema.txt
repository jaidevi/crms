
-- Clients Table
create table public.clients (
  id uuid default gen_random_uuid() primary key,
  name text not null,
  phone text,
  email text,
  address text,
  city text,
  state text,
  pincode text,
  gst_no text,
  pan_no text,
  payment_terms text,
  processes jsonb default '[]'::jsonb,
  created_at timestamptz default now()
);

-- Purchase Shops Table
create table public.purchase_shops (
  id uuid default gen_random_uuid() primary key,
  name text not null,
  phone text,
  email text,
  address text,
  city text,
  state text,
  pincode text,
  gst_no text,
  pan_no text,
  payment_terms text,
  created_at timestamptz default now()
);

-- Employees Table
create table public.employees (
  id uuid default gen_random_uuid() primary key,
  name text not null,
  designation text,
  phone text,
  daily_wage numeric default 0,
  rate_per_meter numeric default 0,
  created_at timestamptz default now()
);

-- Process Types Master Table
create table public.process_types (
  id uuid default gen_random_uuid() primary key,
  name text not null,
  rate numeric default 0,
  created_at timestamptz default now()
);

-- Master Items Table (for Purchase Orders)
create table public.master_items (
  id uuid default gen_random_uuid() primary key,
  name text not null,
  rate numeric default 0,
  created_at timestamptz default now()
);

-- Expense Categories Table
create table public.expense_categories (
  id uuid default gen_random_uuid() primary key,
  name text not null,
  created_at timestamptz default now()
);

-- Purchase Orders Table
create table public.purchase_orders (
  id uuid default gen_random_uuid() primary key,
  po_number text not null unique,
  po_date date not null,
  shop_name text,
  total_amount numeric default 0,
  gst_no text,
  payment_mode text,
  status text,
  payment_terms text,
  reference_id text,
  bank_name text,
  cheque_date date,
  created_at timestamptz default now()
);

-- Purchase Order Items Table
create table public.purchase_order_items (
  id uuid default gen_random_uuid() primary key,
  purchase_order_id uuid references public.purchase_orders(id) on delete cascade,
  name text,
  quantity numeric,
  rate numeric,
  amount numeric
);

-- Delivery Challans Table
create table public.delivery_challans (
  id uuid default gen_random_uuid() primary key,
  challan_number text not null unique,
  date date not null,
  party_name text,
  party_dc_no text,
  process jsonb, 
  design_no text,
  pcs integer,
  mtr numeric,
  width numeric,
  shrinkage text,
  pin text,
  pick text,
  extra_work text,
  status text,
  worker_name text,
  working_unit text,
  is_outsourcing boolean default false,
  dc_image jsonb,
  sample_image jsonb,
  created_at timestamptz default now()
);

-- Invoices Table
create table public.invoices (
  id uuid default gen_random_uuid() primary key,
  invoice_number text not null unique,
  invoice_date date not null,
  client_name text,
  sub_total numeric default 0,
  total_cgst numeric default 0,
  total_sgst numeric default 0,
  total_tax_amount numeric default 0,
  rounded_off numeric default 0,
  total_amount numeric default 0,
  created_at timestamptz default now()
);

-- Invoice Items Table
create table public.invoice_items (
  id uuid default gen_random_uuid() primary key,
  invoice_id uuid references public.invoices(id) on delete cascade,
  challan_number text,
  challan_date date,
  process text,
  description text,
  design_no text,
  hsn_sac text,
  pcs integer,
  mtr numeric,
  rate numeric,
  subtotal numeric,
  cgst numeric,
  sgst numeric,
  amount numeric
);

-- Payments Received Table
create table public.payments_received (
  id uuid default gen_random_uuid() primary key,
  client_name text,
  payment_date date,
  amount numeric,
  payment_mode text,
  reference_number text,
  notes text,
  created_at timestamptz default now()
);

-- Attendance Table
create table public.attendance (
  id uuid default gen_random_uuid() primary key,
  employee_id uuid references public.employees(id) on delete cascade,
  date date not null,
  morning_status text,
  evening_status text,
  morning_overtime_hours numeric default 0,
  evening_overtime_hours numeric default 0,
  meters_produced numeric default 0,
  created_at timestamptz default now(),
  updated_at timestamptz default now(),
  unique(employee_id, date)
);

-- Employee Advances Table
create table public.employee_advances (
  id uuid default gen_random_uuid() primary key,
  employee_id uuid references public.employees(id) on delete cascade,
  date date,
  amount numeric default 0,
  paid_amount numeric default 0,
  notes text,
  created_at timestamptz default now()
);

-- Other Expenses Table
create table public.other_expenses (
  id uuid default gen_random_uuid() primary key,
  date date,
  item_name text,
  amount numeric default 0,
  notes text,
  payment_mode text,
  payment_status text,
  payment_terms text,
  bank_name text,
  cheque_date date,
  created_at timestamptz default now()
);

-- Timber Expenses Table
create table public.timber_expenses (
  id uuid default gen_random_uuid() primary key,
  date date,
  supplier_name text,
  load_weight numeric default 0,
  vehicle_weight numeric default 0,
  cft numeric default 0,
  rate numeric default 0,
  amount numeric default 0,
  notes text,
  payment_mode text,
  payment_status text,
  payment_terms text,
  bank_name text,
  cheque_date date,
  created_at timestamptz default now()
);

-- Supplier Payments Table
create table public.supplier_payments (
  id uuid default gen_random_uuid() primary key,
  payment_number text,
  date date,
  supplier_name text,
  amount numeric default 0,
  payment_mode text,
  reference_id text,
  image text,
  created_at timestamptz default now()
);

-- Payslips Table
create table public.payslips (
  id uuid default gen_random_uuid() primary key,
  employee_id uuid references public.employees(id) on delete set null,
  employee_name text,
  payslip_date date,
  pay_period_start date,
  pay_period_end date,
  total_working_days numeric,
  ot_hours numeric,
  wage_earnings numeric,
  production_earnings numeric,
  gross_salary numeric,
  advance_deduction numeric,
  net_salary numeric,
  total_outstanding_advance numeric,
  created_at timestamptz default now()
);

-- Company Details Table (Singleton)
create table public.company_details (
  id uuid default gen_random_uuid() primary key,
  name text,
  address_line_1 text,
  address_line_2 text,
  phone text,
  email text,
  gstin text,
  bank_name text,
  bank_account_number text,
  bank_ifsc_code text
);

-- Numbering Configs Table
create table public.numbering_configs (
  id text primary key,
  prefix text,
  next_number integer,
  mode text
);

-- Initial Data Seeding

-- 1. Company Details
insert into public.company_details (name) 
select 'Shri Skandaguru Textile Process' 
where not exists (select 1 from public.company_details);

-- 2. Numbering Configurations
insert into public.numbering_configs (id, prefix, next_number, mode) values
('po', 'PO', 1, null),
('delivery_challan', 'DC', 1, null),
('invoice', 'INV/SKTP/-', 24255, 'auto'),
('supplier_payment', 'SP', 1, null)
on conflict (id) do nothing;
